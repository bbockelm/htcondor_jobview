<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://genshi.edgewall.org/">
  <head>
    <title>$site_name Job Overview</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css" rel="stylesheet">
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
    <script type='text/javascript' src='https://www.google.com/jsapi'></script>
    
    <script type='text/javascript'>
    google.load('visualization', '1', {packages:['table']});
    $(document).ready(function() {
        // First, get the jobs
        $.get('jobs', gotjobs);
        
        // Next get the cluster information
        $.get('cluster', gotcluster);
        
    });
    
    function gotjobs(data){
        // data is a json object
        
        // Draw the jobs table
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'User');
        data.addColumn('string', 'Group');
        data.addColumn('number', 'Jobs');
        data.addColumn('number', 'Running');
        data.addColumn('number', 'Pending');
        data.addColumn('number', 'Held');
        data.addColumn('number', 'CPU Eff (%)');
        data.addColumn('string', 'DN');
        
        for (user in data.user) {
            data.addRow(user.Owner, user.AccountingGroup, user.Jobs, user.Running, user.Pending, user.Held, user.cpu_eff, user.X509UserProxySubject);
        }
        var table = new google.visualization.Table(document.getElementById('users_table'));
        table.draw(data);
        
    }
    </script>
    
    
  </head>
  <body class="index">
    <div id="header">
      <h1>$site_name Job Overview</h1>
    </div>

    <div id="cpu_slots">
    <h2>CPU Slots</h2>
    <table>
    <tr><td>Available</td><td>Occupied</td><td>Free</td></tr>
    <tr><td>${cpu_slots.total}</td><td>${cpu_slots['total'] - cpu_slots['free']}</td><td>${cpu_slots.free}</td></tr>
    </table>
    </div>

    <div id="jobs">
    <h2>Job Slots</h2>
    <table>
    <tr><td>Jobs</td><td>Running</td><td>Pending</td><td>Held</td><td>CPU Eff(%)</td><td>Jobs(Eff&lt;10%)</td></tr>
    <tr><td>${jobs.jobs}</td><td>${jobs.running}</td><td>${jobs.pending}</td><td>${jobs.held}</td><td>${int(round(100*jobs['cpu_eff']))}</td><td>${jobs.low_eff}</td></tr>
    </table>
    </div>

    <div id="groups">
    <h2>Groups</h2>
    <div id='users_table'> </div>
    </div>

    <div id="schedd">
    <h2>Schedulers</h2>
    <table>
    <tr><td>Scheduler</td><td>Jobs</td><td>Running</td><td>Pending</td><td>Held</td><td>CPU Eff(%)</td><td>Jobs(Eff&lt;10%)</td></tr>
    <tr py:for="name, group in schedds.items()">
      <td>$name</td><td>${group.jobs}</td><td>${group.running}</td><td>${group.pending}</td><td>${group.held}</td><td>${int(round(100*group['cpu_eff']))}</td><td>${group.low_eff}</td>
    </tr>
    </table>
    </div>

  </body>
</html>
